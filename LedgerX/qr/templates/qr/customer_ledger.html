<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Customer Ledger</title>

  <!-- Bootstrap 5 -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <style>
    .amount-credit { color: #dc3545; font-weight: 600; }
    .amount-payment { color: #198754; font-weight: 600; }
    .balance-due { color: #dc3545; }
    .balance-paid { color: #198754; }
    .balance-advance { color: #0d6efd; }
    .tx-card { border-left: 5px solid transparent; }
    .tx-credit { border-color: #dc3545; }
    .tx-payment { border-color: #198754; }
  </style>
</head>

<body class="bg-light">

<div class="container py-4">

  <!-- HEADER CARD -->
  <div class="card shadow-sm mb-4">
    <div class="card-body text-center">
      <h4 class="mb-1">{{ customer.name }}</h4>
      <small class="text-muted">ðŸ“ž {{ customer.mobile }}</small>

      <hr>

      <h5>
        Outstanding:
        {% if outstanding_amount > 0 %}
          <span class="balance-due">â‚¹{{ outstanding_amount }} (Due)</span>
        {% elif outstanding_amount == 0 %}
          <span class="balance-paid">â‚¹0 (Paid)</span>
        {% else %}
          <span class="balance-advance">
            â‚¹{{ outstanding_amount|floatformat:2 }} (Advance)
          </span>
        {% endif %}
      </h5>

      <button onclick="window.print()" class="btn btn-outline-secondary btn-sm mt-2">
        ðŸ–¨ Print Ledger
      </button>
    </div>
  </div>

  <!-- TRANSACTIONS -->
  {% for row in ledger_rows %}
  <div class="card shadow-sm mb-3 tx-card
    {% if row.tx.transaction_type == 'CREDIT' %}tx-credit{% else %}tx-payment{% endif %}">
    <div class="card-body">

      <div class="d-flex justify-content-between">
        <strong>{{ row.tx.transaction_date|date:"d M Y" }}</strong>
        {% if row.tx.transaction_type == 'CREDIT' %}
          <span class="amount-credit">CREDIT</span>
        {% else %}
          <span class="amount-payment">PAYMENT</span>
        {% endif %}
      </div>

      <div class="mt-2">
        Amount:
        <strong>â‚¹{{ row.tx.total_amount }}</strong>
      </div>

      <div class="mt-1">
        Balance:
        {% if row.balance > 0 %}
          <span class="balance-due">â‚¹{{ row.balance }} Due</span>
        {% elif row.balance == 0 %}
          <span class="balance-paid">â‚¹0 Paid</span>
        {% else %}
          <span class="balance-advance">
            â‚¹{{ row.abs_balance }} Advance
          </span>
        {% endif %}
      </div>

      {% if row.tx.transaction_type != 'PAYMENT' %}
      <div class="mt-2">
        <a
          href="{% url 'qr_transaction_detail' qr_token.secure_token row.tx.id %}"
          class="btn btn-sm btn-primary"
        >
          View Bill â†’
        </a>
      </div>
      {% endif %}

    </div>
  </div>
  {% empty %}
    <p class="text-center text-muted">No transactions found</p>
  {% endfor %}

  <!-- FOOTER -->
  <div class="text-center text-muted mt-4">
    <small>
      ðŸ”’ This ledger is read-only and shared via QR for transparency
    </small>
  </div>

</div>

</body>
</html>
